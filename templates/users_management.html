{% extends 'base.html' %}

{% block title %}Gerenciar usuarios{% endblock %}

{% block content %}
<section class="dashboard">
    <header class="dashboard-header">
        <div>
            <h1>Gerenciar usuarios</h1>
            <p>TI pode resetar senhas, excluir registros e promover colegas ao time TI.</p>
        </div>
    </header>
    <div class="table-wrapper">
        {% if not promotable_users %}
            <div class="alert">
                Nenhum usuario disponivel para promocao. Crie outro cadastro nao pertencente ao time TI para ver o botao "Promover a TI".
            </div>
        {% endif %}
        <table>
            <thead>
                <tr>
                    <th>Usuario</th>
                    <th>E-mail</th>
                    <th>Setor</th>
                    <th>Grupo</th>
                    <th>Acoes</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                    <tr>
                        <td>{{ user.username }}</td>
                        <td>{{ user.email }}</td>
                        <td>
                            {% if user.perfil %}
                                {{ user.perfil.setor }}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>{{ user.group_names }}</td>
                        <td>
                            <form method="post" class="inline-form">
                                {% csrf_token %}
                                <input type="hidden" name="user_id" value="{{ user.id }}">
                                <button class="cta-button cta-outline" name="action" value="reset_password">Resetar senha (1234)</button>
                                {% if user.is_ti_member %}
                                    {% if user != request.user %}
                                        <button class="cta-button cta-outline" name="action" value="revoke_ti">Remover TI</button>
                                    {% endif %}
                                {% else %}
                                    <button class="cta-button cta-primary" name="action" value="grant_ti">Promover a TI</button>
                                {% endif %}
                                {% if user != request.user %}
                                    <button class="cta-button cta-reopen" name="action" value="delete_user" onclick="return confirm('Deseja excluir {{ user.username }}?');">Excluir</button>
                                {% endif %}
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</section>
{% endblock %}
